CREATE DATABASE QuizPollApp;

CREATE TABLE User(userHash CHAR(128) PRIMARY KEY, userEmail VARCHAR(256) NOT NULL, password CHAR(60) NOT NULL, bdate DATE, username VARCHAR(100), imgUrl VARCHAR(256));

CREATE TABLE Poll(pollId INT PRIMARY KEY AUTO_INCREMENT, creatorHash CHAR(128) NOT NULL, title VARCHAR(256) NOT NULL);

ALTER TABLE Poll ADD CONSTRAINT poll_user_fk FOREIGN KEY (creatorHash) REFERENCES User(userHash) ON DELETE CASCADE ON UPDATE CASCADE;

CREATE TABLE PollOption(pollId INT, optionId INT, text VARCHAR(100) NOT NULL);

ALTER TABLE PollOption ADD CONSTRAINT polloption_poll_fk FOREIGN KEY (pollId) REFERENCES Poll(pollId) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE PollOption ADD PRIMARY KEY (pollId, optionId);

CREATE TABLE PollVote(userHash CHAR(128), pollId INT NOT NULL, optionId INT NOT NULL, voteId INT PRIMARY KEY AUTO_INCREMENT);

ALTER TABLE PollVote ADD CONSTRAINT pollvote_user_fk FOREIGN KEY (userHash) REFERENCES User(userHash) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE PollVote ADD CONSTRAINT pollvote_option_fk FOREIGN KEY (pollId,optionId) REFERENCES PollOption(pollId,optionId) ON DELETE CASCADE ON UPDATE CASCADE;
